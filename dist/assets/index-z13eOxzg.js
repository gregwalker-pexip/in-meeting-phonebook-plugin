(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function c(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(a){if(a.ep)return;a.ep=!0;const s=c(a);fetch(a.href,s)}})();var G=(e=>(e[e.trace=10]="trace",e[e.debug=20]="debug",e[e.info=30]="info",e[e.warn=40]="warn",e[e.error=50]="error",e[e.fatal=60]="fatal",e[e.silent=Number.MAX_SAFE_INTEGER]="silent",e))(G||{});function q(){return Object.freeze({fatal:(e,t)=>console.error(t,e),error:(e,t)=>console.error(t,e),warn:(e,t)=>console.warn(t,e),info:(e,t)=>console.info(t,e),debug:(e,t)=>console.debug(t,e),trace(){},silent(){},redact(){}})}var v=q(),J={},X=e=>{let t=new Array;return{add:c=>{if(e===0)return[];t.length<e?t.splice(e,0,c):t=[...t.slice(1),c]},entries:()=>t.slice(0),forEach:c=>{t.forEach(c)}}},K="Anonymous",Q="AnonymousSignal";function R(e){return e.name||K}function u(e={}){const{allowEmittingWithoutObserver:t=!1,variant:c="generic",bufferSize:l=2,name:a=Q}=e,s=new Set,i=new WeakMap,g=new WeakSet,E=c!=="generic"?X(c==="behavior"?1:l):void 0;function y(o,f){try{const p=i.get(o);v.trace({signal:a,subject:f,observer:o,context:p},`Emitting a subject to observer ${R(o)}`),o.call(p,f),g.has(o)&&P(o)}catch(p){throw v.error({signal:a,error:p,observer:o,subject:f},`emit with error for observer ${R(o)}`),p instanceof RangeError?new RangeError(`RangeError: Possible recursive call when calling ${R(o)} for ${a}`):p}}const b=(o,f)=>{if(s.has(o)){const p=`Observer ${R(o)} has already been added!`;throw v.error({signal:a,observer:o},p),new Error(`DuplicatedObserver: ${p}`)}return v.trace({signal:a,observer:o},`Adding ${R(o)} to ${a}`),s.add(o),f&&i.set(o,f),E?.forEach(p=>{y(o,p)}),()=>P(o)},C=(o,f)=>{if(g.has(o)){const p=`${R(o)} has already been added once to ${a}!`;throw v.error({signal:a,observer:o},p),new Error(`NoOnceAgain: ${p}`)}return g.add(o),b(o,f)},P=o=>{if(!s.delete(o))throw v.error({signal:a,observer:o},`Unable to remove observer ${R(o)}`),new Error(`UnableToRemove: ${R(o)}`);g.delete(o),i.delete(o),v.trace({signal:a,observer:o},`Removed ${R(o)} from ${a}`)},I=()=>s.size;function S(o){if(E)E.add(o);else if(!s.size&&!t){const{stack:f}=J.debug?new Error:{stack:void 0};v.warn({signal:a,subject:o,stack:f},`Emitting ${a} without any observer! This may be a mistake.`)}s.forEach(f=>{y(f,o)})}return{name:a,get size(){return I()},add:b,addOnce:C,remove:P,emit:S}}let A;const Y=new Uint8Array(16);function Z(){if(!A&&(A=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!A))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return A(Y)}const m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));function L(e,t=0){return m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+"-"+m[e[t+4]]+m[e[t+5]]+"-"+m[e[t+6]]+m[e[t+7]]+"-"+m[e[t+8]]+m[e[t+9]]+"-"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]}const ee=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),x={randomUUID:ee};function te(e,t,c){if(x.randomUUID&&!t&&!e)return x.randomUUID();e=e||{};const l=e.random||(e.rng||Z)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,t){c=c||0;for(let a=0;a<16;++a)t[c+a]=l[a];return t}return L(l)}var ne=(e=>(e[e.trace=10]="trace",e[e.debug=20]="debug",e[e.info=30]="info",e[e.warn=40]="warn",e[e.error=50]="error",e[e.fatal=60]="fatal",e[e.silent=Number.MAX_SAFE_INTEGER]="silent",e))(ne||{});function ae(){return Object.freeze({fatal:(e,t)=>console.error(t,e),error:(e,t)=>console.error(t,e),warn:(e,t)=>console.warn(t,e),info:(e,t)=>console.info(t,e),debug:(e,t)=>console.debug(t,e),trace(){},silent(){},redact(){}})}var $=ae();function re(e){return!!(e&&typeof e=="object"&&"chanId"in e&&"event"in e)}function oe(e){return!!(e&&typeof e=="object"&&"chanId"in e&&"replyTo"in e)}function j(e){return`${e?`${e}-`:""}${te()}`}function ie(){const e=new Map,t=new Set;return window.onbeforeunload=()=>{t.forEach(i=>clearInterval(i)),t.clear()},{add:(i,g)=>{if(e.has(i)){$.warn(`A popup with with ID:'${i}' has already been registered`);return}e.set(i,{popup:null,shouldOpen:g})},remove:i=>{e.delete(i)},open:(i,g,E)=>{e.has(i)||e.set(i,{popup:null});const y=e.get(i);if(y?.popup&&!y.popup.closed){$.warn(`Popup with ID:'${i}' is currently opened`);return}if(e.get(i)?.shouldOpen&&!e.get(i)?.shouldOpen?.(E??{}))return;const b=window.open(...g);if(y&&(y.popup=b),b){const C=window.setInterval(()=>{if(b.closed){const P=e.get(i);P&&(P.popup=null),clearInterval(C),t.delete(C)}},500);t.add(C)}},get:i=>e.get(i)?.popup}}var ce=class{constructor(e,t){this.target=e,this.chanId=t,globalThis.addEventListener("message",this.onMessage)}pendingCalls=new Map;eventListeners=new Set;addEventListener(e){this.eventListeners.add(e)}removeEventListener(e){this.eventListeners.delete(e)}emitEvent(e){this.target.postMessage({chanId:this.chanId,...e},"*")}callRPC(e,t,c){const l=j();return $.debug({payload:t,id:l},`'${e}' called for channel ${this.chanId}`),new Promise((a,s)=>{this.pendingCalls.set(l,[a,s]),this.target.postMessage({rpc:e,payload:t,id:l,chanId:this.chanId},"*",c)})}replyRPC(e){this.emitEvent(e)}sendEvent(e){this.emitEvent(e)}unregister(){globalThis.removeEventListener("message",this.onMessage)}onMessage=e=>{if(e.data.chanId!==this.chanId)return;const t=e.data;if($.debug({evt:e},`Message received for channel ${this.chanId}`),oe(t)){const[c,l]=this.pendingCalls.get(t.replyTo)??[];if(!c){$.debug({evt:e},"Resolve fn doesnt exist");return}this.pendingCalls.delete(t.replyTo),c(t.payload)}re(t)&&this.eventListeners.forEach(c=>{c(t)})};get targetWindow(){return this.target}};async function se(e){window.plugin={popupManager:ie()};const t=new ce(window.parent,j(e.id)),c=await t.callRPC("syn",e);if(!c.ack)throw new Error(`Can't register a plugin. ${JSON.stringify(c)}`);const l=new Map,a=new Map,s=new Map,i=new Map,g=u({allowEmittingWithoutObserver:!0}),E=u({allowEmittingWithoutObserver:!0}),y=u({allowEmittingWithoutObserver:!0}),b=u({allowEmittingWithoutObserver:!0}),C=u({allowEmittingWithoutObserver:!0}),P=u({allowEmittingWithoutObserver:!0}),I=u({allowEmittingWithoutObserver:!0}),S=u({allowEmittingWithoutObserver:!0}),o=u({allowEmittingWithoutObserver:!0}),f=u({allowEmittingWithoutObserver:!0}),p=u({allowEmittingWithoutObserver:!0}),B=u({allowEmittingWithoutObserver:!0}),U=u({allowEmittingWithoutObserver:!0}),T=u({allowEmittingWithoutObserver:!0}),V=u({allowEmittingWithoutObserver:!0}),z=u({allowEmittingWithoutObserver:!0});t.addEventListener(n=>{switch(n.event){case"ui:button:click":l.get(n.payload.buttonId)?.onClick.emit(n.payload.input);break;case"ui:form:input":s.get(n.payload.modalId)?.onInput.emit(n.payload.input);break;case"ui:prompt:input":i.get(n.payload.modalId)?.onInput.emit(n.payload.input);break;case"participant:disconnected":a.get(n.payload.participantUuid)?.onDisconnect.emit(),a.delete(n.payload.participantUuid);break;case"event:conferenceStatus":E.emit(n.payload);break;case"event:connected":y.emit(n.payload);break;case"event:disconnected":b.emit(n.payload);break;case"event:me":C.emit(n.payload);break;case"event:message":f.emit(n.payload);break;case"event:directMessage":p.emit(n.payload);break;case"event:applicationMessage":B.emit(n.payload);break;case"event:transfer":U.emit(n.payload);break;case"event:stage":T.emit(n.payload);break;case"event:participants":P.emit(n.payload);break;case"event:participantLeft":S.emit(n.payload),a.get(n.payload.participant.uuid)?.onDisconnect.emit(),a.delete(n.payload.participant.uuid);break;case"event:participantJoined":I.emit(n.payload);break;case"event:raiseHand":o.emit(n.payload);break;case"event:presentationConnectionStateChange":V.emit(n.payload);break;case"event:layoutUpdate":z.emit(n.payload);break;case"event:conference:authenticated":g.emit(n.payload);break}});const O=async(n,r)=>{const d=await t.callRPC("ui:removeElement",{id:n});if(d.status==="failed")return Promise.reject({reason:d.reason});r&&r()};return{ui:{addButton:async n=>{const r=await t.callRPC("ui:button:add",n);if(r.status==="failed")return Promise.reject({reason:r.reason});const d={onClick:u({allowEmittingWithoutObserver:!0}),update:async h=>{const w=await t.callRPC("ui:button:update",{...h,targetId:r.id});return w.status==="failed"?Promise.reject({reason:w.reason}):w.data},remove:()=>O(r.id,()=>l.delete(r.id))};return l.set(r.id,d),d},addForm:async n=>{const r=await t.callRPC("ui:form:open",n);if(r.status==="failed")return Promise.reject({reason:r.reason});const d={onInput:u(),remove:()=>O(r.id,()=>s.delete(r.id))};return s.set(r.id,d),d},showForm:async n=>{const r=await t.callRPC("ui:form:open",n);return r.status==="failed"?Promise.reject({reason:r.reason}):new Promise(d=>{const h=w=>{w.event==="ui:form:input"&&w.payload.modalId===r.id&&(d(w.payload.input),O(r.id),t.removeEventListener(h))};t.addEventListener(h)})},addPrompt:async n=>{const r=await t.callRPC("ui:prompt:open",n);if(r.status==="failed")return Promise.reject({reason:r.reason});const d={onInput:u(),remove:()=>O(r.id,()=>i.delete(r.id))};return i.set(r.id,d),d},showPrompt:async n=>{const r=await t.callRPC("ui:prompt:open",n);return r.status==="failed"?Promise.reject({reason:r.reason}):new Promise(d=>{const h=w=>{w.event==="ui:prompt:input"&&w.payload.modalId===r.id&&(d(w.payload.input),O(r.id),t.removeEventListener(h))};t.addEventListener(h)})},showToast:async n=>{const r=await t.callRPC("ui:toast:show",n);if(r.status==="failed")return Promise.reject({reason:r.reason})}},conference:{dialOut:async n=>{let r;const d=new Map;let h=()=>{};const w=new Promise(_=>{h=I.add(({participant:W})=>{r?r.data.result.includes(W.uuid)&&_(W):d.set(W.uuid,W)})});r=await t.callRPC("conference:dialOut",n);const k=r?.data.result[0];if(!k)throw Error("Could not dial out to specified uri");const H=d.get(k)??await w;h();const D={...H,onDisconnect:u({allowEmittingWithoutObserver:!0}),disconnect:async()=>(a.delete(k),t.callRPC("participant:disconnect",{participantUuid:k}))};return a.set(k,D),D},sendMessage:async n=>await t.callRPC("conference:sendMessage",n),sendApplicationMessage:async n=>await t.callRPC("conference:sendApplicationMessage",n),lock:async n=>await t.callRPC("conference:lock",n),muteAllGuests:async n=>await t.callRPC("conference:muteAllGuests",n),setBandwidth:async n=>await t.callRPC("conference:setBandwidth",n),setLayout:async n=>await t.callRPC("conference:setLayout",n),disconnectAll:async n=>await t.callRPC("conference:disconnectAll",n),requestParticipants:async n=>await t.callRPC("conference:requestParticipants",n),sendRequest:async n=>await t.callRPC("conference:sendRequest",n),transfer:async n=>await t.callRPC("participant:transfer",n),mute:async n=>await t.callRPC("participant:mute",n),muteVideo:async n=>await t.callRPC("participant:muteVideo",n),spotlight:async n=>await t.callRPC("participant:spotlight",n),admit:async n=>await t.callRPC("participant:admit",n),raiseHand:async n=>await t.callRPC("participant:raiseHand",n),setRole:async n=>await t.callRPC("participant:setRole",n),setTextOverlay:async n=>await t.callRPC("participant:setTextOverlay",n),sendDTMF:async n=>await t.callRPC("participant:sendDTMF",n),disconnect:async n=>{const r=n.participantUuid;return a.delete(r),await t.callRPC("participant:disconnect",{participantUuid:r})},breakout:async n=>await t.callRPC("conference:breakout",n),joinBreakoutRoom:async n=>await t.callRPC("conference:joinBreakoutRoom",n),closeBreakouts:async()=>await t.callRPC("conference:closeBreakouts",{}),closeBreakoutRoom:async n=>await t.callRPC("conference:closeBreakoutRoom",n),emptyBreakouts:async()=>await t.callRPC("conference:emptyBreakouts",{}),breakoutMoveParticipants:async n=>await t.callRPC("conference:breakoutMoveParticipants",n),getCurrentRoomId:async()=>await t.callRPC("conference:currentRoomId",void 0)},events:{authenticatedWithConference:g,conferenceStatus:E,connected:y,disconnected:b,me:C,message:f,directMessage:p,applicationMessage:B,transfer:U,stage:T,participants:P,participantJoined:I,participantLeft:S,raiseHand:o,presentationConnectionStateChange:V,layoutUpdate:z}}}const le='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M96 0C60.7 0 32 28.7 32 64V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64H96zM208 288h64c44.2 0 80 35.8 80 80c0 8.8-7.2 16-16 16H144c-8.8 0-16-7.2-16-16c0-44.2 35.8-80 80-80zm-32-96a64 64 0 1 1 128 0 64 64 0 1 1 -128 0zM512 80c0-8.8-7.2-16-16-16s-16 7.2-16 16v64c0 8.8 7.2 16 16 16s16-7.2 16-16V80zM496 192c-8.8 0-16 7.2-16 16v64c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm16 144c0-8.8-7.2-16-16-16s-16 7.2-16 16v64c0 8.8 7.2 16 16 16s16-7.2 16-16V336z" fill="white"/></svg>',ue='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M96 0C60.7 0 32 28.7 32 64V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64H96zM208 288h64c44.2 0 80 35.8 80 80c0 8.8-7.2 16-16 16H144c-8.8 0-16-7.2-16-16c0-44.2 35.8-80 80-80zm-32-96a64 64 0 1 1 128 0 64 64 0 1 1 -128 0zM512 80c0-8.8-7.2-16-16-16s-16 7.2-16 16v64c0 8.8 7.2 16 16 16s16-7.2 16-16V80zM496 192c-8.8 0-16 7.2-16 16v64c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm16 144c0-8.8-7.2-16-16-16s-16 7.2-16 16v64c0 8.8 7.2 16 16 16s16-7.2 16-16V336z" fill="black"/></svg>',de={main:le,hover:ue},pe={videoRooms:[{id:"aaaaa@someaddress.com",label:"Sydney - Boardroom"},{id:"bbbbb@someaddress.com",label:"BrisVegas - Demo Room1"},{id:"ccccc@someaddress.com",label:"Melbourne - Meeting Room1"}]},F="in-meeting-phonebook-plugin";let N;N=[{id:"0",label:"Public"},{id:"1",label:"Private"},{id:"2",label:"Confidential"}];const M=await se({id:F,version:0});M.ui.showToast({message:F,isInterrupt:!0,timeout:5e3});M.events.connected.add(()=>{});const me=await M.ui.addButton({position:"toolbar",icon:{custom:de},tooltip:"Room Directory",roles:["chair"]}).catch(e=>{console.warn(e)});me?.onClick.add(async()=>{const e=await M.ui.addForm({title:"Video Phonebook",description:"Select a (dummy) video system to call.",form:{elements:{directoryList:{name:"",type:"select",options:pe.videoRooms},capabilityList:{name:"",type:"select",options:N}},submitBtnTitle:"Call"}});e.onInput.add(async t=>{e.remove();const c=t.directoryList;c&&(await M.conference.dialOut({role:"GUEST",destination:c,protocol:"auto"}),M.ui.showToast({message:"📞 Calling "+c,isInterrupt:!0,timeout:5e3}))})});
